<html>
    <head>
        <link href="/stylesheets/main.css" type="text/css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Fanwood+Text' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <h1>Monty Hall Problem Demonstration</h1>
        <div class="column">
            <div id="door_display">
                <div id="door_1" class="door">
                </div>
                <div id="door_2" class="door">
                </div>
                <div id="door_3" class="door">
                </div>
            </div>

            <br class="clear" />

            <div class="player">
                <h3 id="stay_result">Stay strategy</h3>
                <dl>
                    <dt>Wins</dt>
                    <dd id="stay_wins">0</dd>
                </dl>
                <dl>
                    <dt>Losses</dt>
                    <dd id="stay_losses">0</dd>
                </dl>
                <dl>
                    <dt>Win Percentage</dt>
                    <dd id="stay_pct">&nbsp;</dd>
                </dl>
            </div>

            <div class="player">
                <h3 id="switch_result">Switch strategy</h3>
                <dl>
                    <dt>Wins</dt>
                    <dd id="switch_wins">0</dd>
                </dl>
                <dl>
                    <dt>Losses</dt>
                    <dd id="switch_losses">0</dd>
                </dl>
                <dl>
                    <dt>Win Percentage</dt>
                    <dd id="switch_pct">&nbsp;</dd>
                </dl>
            </div>

            <br class="clear" />

            <div id="runControl">
                <div id="runState">running</div>
                <button id="runStopButton" onClick="runStop()">STOP</button>
                <div id="speedState">slow</div>
                <button id="speedButton" onClick="changeSpeed()">FASTER</button>
            </div>
        </div>
        <div class="column right">
            <div id="explanation">
                This is a demonstration of a famous problem in probability.
                <br/><br/>
                Imagine you're a contestant on a game show. The host shows you
                three doors and tells you that behind one of the doors is a prize.
                If you can choose the door with the prize the prize is yours.
                <br/><br/>
                You choose one of the three doors. The host then opens a different
                door, showing you that there is no prize behind it.
                He then asks you if you'd like to switch and choose the other not
                yet opened door.
                <br/><br/>
                Should you switch? What are your odds of winning if you stay with
                your original choice, and what are your odds if you switch?
                <br/><br/>
                Counterintuitive though it may be, this demonstration, which chooses
                the first choice, the winning door, and the revealed door&sup1;
                all at random, shows that you double your chances of winning if you
                switch doors when given the chance (2/3 rather than 1/3).
                <br/><br/>
                A few simple explanations:
                <br/><br/>
                1) The probability of winning with the stay strategy is clearly
                1/3. The switch strategy wins if and only if the stay strategy loses.
                <br/><br/>
                2) The switch strategy is equivalent to choosing <b>both</b> of the
                doors not yet chosen, because you win if either of those hides the
                prize. If either does the one you switched to does, because clearly
                the door already open doesn't.
                <br/><br/>
                See the <a href="http://en.wikipedia.org/wiki/Monty_Hall_problem">
                Wikipedia entry</a> for more details.
                <br/><br/>
                <span class="footnote">&sup1; Actually, the script must know (as the
                host does) which is the winning door when choosing which door to
                reveal so that it can be sure to choose a losing door. It either
                chooses one of two at random or has only one choice.
                <br/><br/>
                This is another explanation of the probabilities - if the original
                choice isn't the winner, of the two doors left one is revealed and
                the other is the winner. Thus the switch strategy wins.</span>
            </div>
        </div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript">
            // globals
            running = true
            speed = 100 // slow: 100, fast: 10
            results = []

            function reset() {
                for (n=1; n <= 3; n++) {
                    $('#door_' + n).removeClass('winning losing').html('')
                }
                $('#stay_result').removeClass('winning losing').html('Stay strategy')
                $('#switch_result').removeClass('winning losing').html('Switch strategy')
            }

            function display() {
                result = results.shift()
                if (results.length < 100) {
                    loadResultSet()
                }
                if (result) {
                    reset()
                    setTimeout(function() {
                        $('#door_' + result.initial_choice).html('First Choice')
                    }, speed)
                    setTimeout(function() {
                        $('#door_' + result.revealed_choice).html('Revealed').addClass('losing')
                    }, 2 * speed)
                    setTimeout(function() {
                        $('#door_' + result.switch_choice).html('Switch')
                    }, 3 * speed)
                    setTimeout(function() {
                        $('#door_' + result.winning_choice).addClass('winning')
                        declareWinner(result)
                    }, 4 * speed)
                }
                if (running) {
                    setTimeout("display()", 10 * speed)
                }
            }

            function declareWinner(result) {
                if (result.initial_choice == result.winning_choice) {
                    $('#stay_result').html('Stay strategy WINS')
                    $('#stay_result').removeClass('losing').addClass('winning')
                    $('#stay_wins').text(parseInt($('#stay_wins').text()) + 1)
                } else {
                    $('#stay_result').html('Stay strategy LOSES')
                    $('#stay_result').removeClass('winning').addClass('losing')
                    $('#stay_losses').text(parseInt($('#stay_losses').text()) + 1)
                }
                stay_wins = parseInt($('#stay_wins').text())
                stay_losses = parseInt($('#stay_losses').text())
                stay_pct = stay_wins / (stay_wins + stay_losses) * 100
                $('#stay_pct').text(stay_pct.toFixed(4) + '%')

                if (result.switch_choice == result.winning_choice) {
                    $('#switch_result').html('Switch strategy WINS')
                    $('#switch_result').removeClass('losing').addClass('winning')
                    $('#switch_wins').text(parseInt($('#switch_wins').text()) + 1)
                } else {
                    $('#switch_result').html('Switch strategy LOSES')
                    $('#switch_result').removeClass('winning').addClass('losing')
                    $('#switch_losses').text(parseInt($('#switch_losses').text()) + 1)
                }
                switch_wins = parseInt($('#switch_wins').text())
                switch_losses = parseInt($('#switch_losses').text())
                switch_pct = switch_wins / (switch_wins + switch_losses) * 100
                $('#switch_pct').text(switch_pct.toFixed(4) + '%')
            }

            function loadResultSet() {
                $.get('/results?num=1000',
                        function(data){
                    newResults = $.parseJSON(data)
                    for (var idx in newResults) {
                        results.push(newResults[idx])
                    }
                })
            }

            function runStop() {
                if (running == false) {
                    running = true
                    $('#runStopButton').html('STOP')
                    $('#runState').html('running')
                    display()
                } else {
                    running = false
                    results = []
                    $('#runStopButton').html('RUN')
                    $('#runState').html('stopped')
                }
            }

            function changeSpeed() {
                if (speed == 100) {
                    $('#speedState').html('fast')
                    $('#speedButton').html('SLOWER')
                    speed = 10
                } else {
                    $('#speedState').html('slow')
                    $('#speedButton').html('FASTER')
                    speed = 100
                }
            }

            $(document).ready(function(){
                display()
            })
        </script>
    </body>
</html>